#!/bin/sh
# SPDX-License-Identifier: GPL-2.0 OR BSD-2-Clause
# X-SPDX-Copyright-Text: (c) Copyright 2021-2022 Xilinx, Inc.

echo "// Autogenerated file, do not edit"
echo "#define ONLOAD_PRODUCT \"Onload\""
year=`date '+%Y'`
echo "#define ONLOAD_COPYRIGHT \"Copyright 2019-$year Xilinx, 2006-2019 Solarflare Communications, 2002-2005 Level 5 Networks\""
echo "#ifndef ONLOAD_BUILD_PROFILE"
echo "#define ONLOAD_BUILD_PROFILE \"\""
echo "#endif"
echo -n "#define ONLOAD_VERSION \""

human_name=""
if test -f `which git`; then
  hash=`git show -s --format="format:%h %cd"  --date=short HEAD`
  echo -n $hash
  human_name=`git symbolic-ref -q --short HEAD`
  test -z "$human_name" && human_name=`git describe --tags --exact-match`
  test -n "$human_name" && echo -n " $human_name"
else
  echo -n "<dev-snapshot>"
fi
echo " \"ONLOAD_BUILD_PROFILE"

if test -z "$human_name"; then
  human_name="<dev-snapshot>"
fi
echo "#define ONLOAD_SHORT_VERSION \"$human_name \"ONLOAD_BUILD_PROFILE"
